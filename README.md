
# Юзерскрипт локального сохранения постов для DragonsEmpire

Наверняка у вас была подобная ситуация: вы уже почти написали пост, но случайно нажимаете на клавиатуре не ту кнопку и-и... работа нескольких часов потеряна навсегда *(почти)*. Или вы писали пост так долго, что система посчитала, что вас уже можно деавторизовать, и при отправке поста вы его теряете... Как с этим бороться? Заводить txt-файл и копировать туда-сюда текст с форума?
Данный скрипт добавляет функционал сохранения текста поста к обычным страницам форума DragonsEmpire. В частности, скрипт:

 - Позволяет сохранить текст поста в локальном хранилище
 - Восстановить текст поста из локального хранилища
 - Включить авто-сохранение поста по таймеру

Вся информация сохраняется в **локальной памяти браузера** и остаются в ней между перезагрузками страницы и закрытиями браузера. Согласно [официальной документации](https://developer.mozilla.org/en-US/docs/Web/API/Window/localStorage) данная информация будет доступна только для текущего сайта (с таким же доменом), что гарантирует безопасность данных.

Скрипт распространяется по методу "as is", то есть, автор программы не несёт ответственности за утерянную или повреждённую информацию в результате работы скрипта.
## Установка

 - Установите расширение **Tampermonkey** для вашего браузера. Для поиска воспользуйтесь поиском Google или перейдите [по прямой ссылке](https://chrome.google.com/webstore/detail/tampermonkey/dhdgffkkebhmkfjojejmpbldmpobfkfo) (актуально на 09.06.21).
 - Откройте файл "main.js" в данном репозитории в режиме "Raw" ([прямая ссылка](https://raw.githubusercontent.com/YoungTeurus/DragonsEmpire-AutoPostSaver/main/main.js)). Скопируйте содержимое файла в буфер обмена.
 - В меню Tampermonkey, открывающемся по левому клику на иконке приложения, выберите "*Создать новый скрипт*".
 - Выделите всё содержимое шаблона скрипта, удалите его и вставьте код данного скрипта из буфера обмена.
 - Сохраните скрипт нажатием пункта меню "Файл"->"Сохранить". Вы готовы к использованию скрипта.
## Использование
Скрипт работает только на страницах тем, которые открыты для ответов. Действие скрипта вы заметите по появившимся кнопкам под текстовым полем для ввода ответа на тему (см. скриншот).
![Добавленные кнопки](https://raw.githubusercontent.com/YoungTeurus/DragonsEmpire-AutoPostSaver/main/screens/Interface-0-Overview.png)
Попробуйте сохранить какое-либо сообщение, набрав его в поле ввода и нажав кнопку "*Сохранить*"!
![Сохранения поста](https://raw.githubusercontent.com/YoungTeurus/DragonsEmpire-AutoPostSaver/main/screens/Interface-1-Saving.png)
Теперь, перезагрузив страницу, попробуйте нажать кнопку "*Восстановить*".
![Восстановление текста поста](https://raw.githubusercontent.com/YoungTeurus/DragonsEmpire-AutoPostSaver/main/screens/Interface-2-Restoring.gif)
Если вы попробуете восстановить текст, когда в поле уже набран какой-то текст, вы получите соответствующее предупреждение:
![Восстановление с уже напечатанным текстом поста](https://raw.githubusercontent.com/YoungTeurus/DragonsEmpire-AutoPostSaver/main/screens/Interface-3-Saving%20with%20text%20in%20textarea.png)
Сохранённый пост можно навсегда удалить, нажав крайнюю правую кнопку "*Удалить сохранение*", после чего будет необходимо подтвердить своё действие.
![Удаление сохранения](https://raw.githubusercontent.com/YoungTeurus/DragonsEmpire-AutoPostSaver/main/screens/Interface-4-Clearing.png)
Функция автосохранения поста включается нажатием на соответствующую кнопку. Текущее состояние можно понять по тексту на ней:
![Переключение автосохранения](https://raw.githubusercontent.com/YoungTeurus/DragonsEmpire-AutoPostSaver/main/screens/Interface-4-Toggling%20autosave.gif)
На данный момент автосохранение:
 - Срабатывает раз в 15 секунд (смотри комментарий в коде, чтобы изменить).
 - Не заменяет сохранённый текст пустым (защита от перезагрузки страницы).
 - Сохраняет состояние автосохранения между перезаходами на страницу (уникально для каждый темы).
